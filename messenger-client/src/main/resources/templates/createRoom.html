<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="header :: headerFragment">
    <style>
        .form-section {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="includeBaseBody" th:replace="header :: bodyFragment"></div>

<div class="container mt-5">
    <h2>Создать комнату</h2>
    <form th:action="@{/rooms/create}" th:object="${roomForm}" method="post" style="border-bottom-width: 10px">
        <div class="form-section">
            <label for="participantUsername">Имя пользователя:</label>
            <input type="text" id="participantUsername" name="participantUsername" class="form-control" th:field="*{participantUsername}" required/>
        </div>

        <div class="form-section">
            <label for="mode">Режим шифрования:</label>
            <select id="mode" name="mode" class="form-control" th:field="*{mode}" onchange="toggleEncryptionFields()" required>
                <option value="" disabled selected>Выберите режим шифрования</option>
                <option th:each="type : ${modes}" th:value="${type}" th:text="${type}"></option>
            </select>
        </div>

        <div class="form-section">
            <label for="padding">Тип набивки:</label>
            <select id="padding" name="padding" class="form-control" th:field="*{padding}" onchange="toggleEncryptionFields()" required>
                <option value="" disabled selected>Выберите тип набивки</option>
                <option th:each="type : ${paddings}" th:value="${type}" th:text="${type}"></option>
            </select>
        </div>

        <div class="form-section">
            <label for="encryptionType">Тип шифрования:</label>
            <select id="encryptionType" name="encryptionType" class="form-control" th:field="*{encryptionType}" onchange="toggleEncryptionFields()" required>
                <option value="" disabled selected>Выберите тип шифрования</option>
                <option th:each="type : ${encryptionTypes}" th:value="${type}" th:text="${type}"></option>
            </select>
        </div>

        <div id="camelliaFields" class="form-section" style="display:none;">
            <label for="camelliaKeySize">Размер ключа Camellia:</label>
            <select id="camelliaKeySize" name="camelliaPayload.camelliaKeySize" class="form-control" th:field="*{camelliaPayload.camelliaKeySize}">
                <option th:each="size : ${camelliaKeySizes}" th:value="${size}" th:text="${size}"></option>
            </select>
        </div>

        <div id="rc5Fields" class="form-section" style="display:none;">
            <label for="wordLengthBytes">Длина слова RC5:</label>
            <select id="wordLengthBytes" name="rc5Payload.wordLengthBytes" class="form-control" th:field="*{rc5Payload.wordLengthBytes}">
                <option th:each="length : ${rc5WordLengths}" th:value="${length}" th:text="${length}"></option>
            </select>

            <label for="roundCount">Количество раундов:</label>
            <input type="number" id="roundCount" name="rc5Payload.roundCount" class="form-control" th:field="*{rc5Payload.roundCount}"/>

            <label for="keyLength">Длина ключа:</label>
            <input type="number" id="keyLength" name="rc5Payload.keyLength" class="form-control" th:field="*{rc5Payload.keyLength}"/>
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Создать</button>
        </div>
    </form>
    <div th:if="${errors != null}">
        <ul>
            <li th:each="err : ${errors}" th:if="${not #strings.isEmpty(err)}" th:text="${err}"
                style="color: red"></li>
        </ul>
    </div>
</div>

<script>
    function toggleEncryptionFields() {
        const encryptionType = document.getElementById('encryptionType').value;
        document.getElementById('camelliaFields').style.display = encryptionType === 'CAMELLIA' ? 'block' : 'none';
        document.getElementById('rc5Fields').style.display = encryptionType === 'RC5' ? 'block' : 'none';
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        toggleEncryptionFields(); // Call the function to set the initial state
    });
</script>
</body>
</html>